<!DOCTYPE html>
<html lang="es" data-include-header="true">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplo - Header Global Ledroitsender</title>
    
    <!-- PASO 1: Incluir Firebase SDK (si usas Firebase) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <!-- PASO 2: Incluir archivos del header -->
    <link rel="stylesheet" href="./assets/global-header.css">
    <script src="./assets/firebase-init.js"></script>
    <script src="./assets/ledroitmaster-auth.js"></script>
    <script src="./assets/global-header.js"></script>
    
    <style>
        /* Estilos de ejemplo para la p√°gina */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-content {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            color: #1f2937;
            margin-top: 0;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .success {
            background: #d1edff;
            padding: 15px;
            border-left: 4px solid #0066cc;
            margin: 15px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- El header se insertar√° autom√°ticamente aqu√≠ -->
    
    <div class="main-content">
        <div class="card">
            <h2>üéØ Ejemplo de Implementaci√≥n del Header Global</h2>
            <p>Esta p√°gina demuestra c√≥mo implementar el sistema de header global de Ledroitsender en otros sistemas.</p>
            
            <div class="success">
                <strong>‚úÖ Header Activo:</strong> El header se ha cargado autom√°ticamente porque el elemento HTML tiene el atributo <code>data-include-header="true"</code>.
            </div>
        </div>

        <div class="card">
            <h2>üìã Pasos para Implementar</h2>
            
            <h3>1. Copiar Archivos Necesarios</h3>
            <p>Copia estos archivos a tu proyecto:</p>
            <div class="code-block">
assets/
‚îú‚îÄ‚îÄ global-header.css
‚îú‚îÄ‚îÄ global-header.js
‚îú‚îÄ‚îÄ global-header-template.html
‚îú‚îÄ‚îÄ firebase-init.js (opcional)
‚îî‚îÄ‚îÄ ledroitmaster-auth.js (opcional)
            </div>

            <h3>2. Incluir en tu HTML</h3>
            <div class="code-block">
&lt;!-- En el &lt;head&gt; --&gt;
&lt;link rel="stylesheet" href="./assets/global-header.css"&gt;
&lt;script src="./assets/firebase-init.js"&gt;&lt;/script&gt;
&lt;script src="./assets/ledroitmaster-auth.js"&gt;&lt;/script&gt;
&lt;script src="./assets/global-header.js"&gt;&lt;/script&gt;

&lt;!-- En el &lt;html&gt; --&gt;
&lt;html data-include-header="true"&gt;
            </div>

            <h3>3. Configurar Sesi√≥n de Usuario</h3>
            <p>El header necesita datos de sesi√≥n en <code>sessionStorage</code>:</p>
            <div class="code-block">
// Estructura m√≠nima requerida
const sessionData = {
    user: {
        nombre: "Nombre del Usuario",
        foto_url: "URL_del_avatar",
        empresas: [
            {
                nombre: "Empresa 1",
                empresa_activa: true,
                usuario_activo: true,
                rol: ["admin"]
            }
        ]
    },
    iniciales: "AB" // ‚úÖ Usar "iniciales" (nomenclatura est√°ndar)
};

sessionStorage.setItem('ls_session', JSON.stringify(sessionData));
window.ledroitAuth = sessionData;
            </div>
        </div>

        <div class="card">
            <h2>‚öôÔ∏è Tipos de Header Disponibles</h2>
            
            <h3>Header Completo</h3>
            <div class="code-block">&lt;html data-include-header="true"&gt;</div>
            <p>Muestra logo, nombre de usuario, empresas y bot√≥n de logout.</p>

            <h3>Header M√≠nimo</h3>
            <div class="code-block">&lt;html data-include-header="minimal"&gt;</div>
            <p>Solo muestra logo y nombre de la aplicaci√≥n.</p>

            <h3>Solo Brand</h3>
            <div class="code-block">&lt;html data-include-header="brand-only"&gt;</div>
            <p>Logo, nombre y subt√≠tulo de la aplicaci√≥n.</p>

            <h3>Sin Header</h3>
            <div class="code-block">&lt;html&gt; &lt;!-- Sin atributo data-include-header --&gt;</div>
            <p>No se muestra ning√∫n header.</p>
        </div>

        <div class="card">
            <h2>üîß Personalizaci√≥n</h2>
            
            <h3>Configurar Logo y Nombre</h3>
            <p>Edita <code>global-header.js</code> l√≠neas 15-20:</p>
            <div class="code-block">
this.config = {
    templatePath: './assets/global-header-template.html',
    cssPath: './assets/global-header.css',
    logoPath: './assets/tu-logo.svg',
    appName: 'Tu Aplicaci√≥n'
};
            </div>

            <h3>Adaptar Sistema de Autenticaci√≥n</h3>
            <p>Modifica <code>ledroitmaster-auth.js</code> para tu API:</p>
            <div class="code-block">
constructor() {
    this.apiUrl = 'https://tu-api.com/login';
    this.sistemaOrigen = 'TU_SISTEMA';
    // ...
}
            </div>

            <h3>Configurar Firebase (Opcional)</h3>
            <p>Si usas Firebase, actualiza <code>firebase-init.js</code>:</p>
            <div class="code-block">
const firebaseConfig = {
    apiKey: "tu-api-key",
    authDomain: "tu-proyecto.firebaseapp.com",
    projectId: "tu-proyecto",
    // ...
};
            </div>
        </div>

        <div class="card">
            <h2>üéÆ Controles Program√°ticos</h2>
            
            <h3>Refrescar Header</h3>
            <div class="code-block">
// M√©todo 1: Funci√≥n global
window.refreshGlobalHeader();

// M√©todo 2: Evento personalizado
window.dispatchEvent(new CustomEvent('globalHeaderRefresh'));

// M√©todo 3: Instancia directa
window.globalHeaderInstance.refresh();
            </div>

            <h3>Eventos Disponibles</h3>
            <div class="code-block">
// Escuchar cambios de sesi√≥n
window.addEventListener('sessionChanged', (event) => {
    console.log('Sesi√≥n actualizada:', event.detail);
});

// Escuchar logout
window.addEventListener('userLogout', () => {
    console.log('Usuario cerr√≥ sesi√≥n');
});
            </div>
        </div>

        <div class="card">
            <h2>üöÄ Prueba en Vivo</h2>
            <p>Usa los botones de abajo para probar las funcionalidades del header:</p>
            
            <button onclick="testRefreshHeader()" style="margin: 5px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                üîÑ Refrescar Header
            </button>
            
            <button onclick="testChangeUser()" style="margin: 5px; padding: 10px 15px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                üë§ Cambiar Usuario
            </button>
            
            <button onclick="testToggleCompanies()" style="margin: 5px; padding: 10px 15px; background: #ffc107; color: black; border: none; border-radius: 4px; cursor: pointer;">
                üè¢ Toggle Empresas
            </button>
        </div>
    </div>

    <script>
        // Funciones de prueba
        function testRefreshHeader() {
            console.log('Refrescando header...');
            window.refreshGlobalHeader();
        }

        function testChangeUser() {
            const newUser = {
                user: {
                    nombre: "Usuario de Prueba",
                    foto_url: null,
                    empresas: [
                        {
                            nombre: "Empresa Demo",
                            empresa_activa: true,
                            usuario_activo: true,
                            rol: ["demo"]
                        }
                    ]
                },
                iniciales: "UP" // ‚úÖ Usar "iniciales" (nomenclatura est√°ndar)
            };
            
            sessionStorage.setItem('ls_session', JSON.stringify(newUser));
            window.ledroitAuth = newUser;
            window.dispatchEvent(new CustomEvent('sessionChanged', { detail: newUser }));
        }

        function testToggleCompanies() {
            const currentSession = JSON.parse(sessionStorage.getItem('ls_session') || '{}');
            if (currentSession.user) {
                const hasCompanies = currentSession.user.empresas && currentSession.user.empresas.length > 0;
                
                if (hasCompanies) {
                    currentSession.user.empresas = [];
                } else {
                    currentSession.user.empresas = [
                        {
                            nombre: "Empresa Alpha",
                            empresa_activa: true,
                            usuario_activo: true,
                            rol: ["admin", "user"]
                        },
                        {
                            nombre: "Empresa Beta",
                            empresa_activa: false,
                            usuario_activo: true,
                            rol: ["user"]
                        },
                        {
                            nombre: "Empresa Gamma",
                            empresa_activa: true,
                            usuario_activo: false,
                            rol: ["viewer"]
                        }
                    ];
                }
                
                sessionStorage.setItem('ls_session', JSON.stringify(currentSession));
                window.ledroitAuth = currentSession;
                window.dispatchEvent(new CustomEvent('sessionChanged', { detail: currentSession }));
            }
        }

        // Simular datos de sesi√≥n para la demo
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const demoSession = {
                    user: {
                        nombre: "Usuario Demo",
                        foto_url: null,
                        empresas: [
                            {
                                nombre: "Empresa Ejemplo",
                                empresa_activa: true,
                                usuario_activo: true,
                                rol: ["admin"]
                            },
                            {
                                nombre: "Empresa Secundaria",
                                empresa_activa: true,
                                usuario_activo: true,
                                rol: ["user"]
                            }
                        ]
                    },
                    iniciales: "UD" // ‚úÖ Usar "iniciales" (nomenclatura est√°ndar)
                };
                
                sessionStorage.setItem('ls_session', JSON.stringify(demoSession));
                window.ledroitAuth = demoSession;
                
                // Refrescar header despu√©s de establecer la sesi√≥n
                setTimeout(() => {
                    window.dispatchEvent(new CustomEvent('sessionChanged', { detail: demoSession }));
                }, 500);
            }, 1000);
        });
    </script>
</body>
</html>